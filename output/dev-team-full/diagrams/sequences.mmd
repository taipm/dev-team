%% Sequence Diagram - Agent Creation and Team Execution Flow
%% Generated by Diagram Team - Session DTT-2026-01-04-DIAGRAM-002

sequenceDiagram
    autonumber

    participant User
    participant FatherAgent as Father Agent
    participant DesignDoc as Design Document
    participant DeepThinking as Deep Thinking Team
    participant Maestro as Maestro
    participant Agents as Parallel Agents
    participant ClaudeAPI as Claude API
    participant Output as Output

    rect rgb(200, 220, 255)
    Note over User,ClaudeAPI: FLOW 1: Agent Creation (Design Review + Deep Thinking)

    User->>FatherAgent: /create agent<br/>Domain, Patterns, Style
    FatherAgent->>FatherAgent: Phase 1: DISCOVER<br/>Validate input
    FatherAgent->>FatherAgent: Phase 2: CHECK<br/>Overlap detection

    alt Overlap Detected
        FatherAgent->>User: Suggest extend existing?
        User->>FatherAgent: Create anyway
    end

    FatherAgent->>DesignDoc: Phase 3: CREATE<br/>Design Document
    DesignDoc->>DesignDoc: Generate UUID<br/>Populate template

    FatherAgent->>DeepThinking: Submit Design<br/>for mandatory review
    rect rgb(255, 200, 200)
    DeepThinking->>DeepThinking: Socrates: Clarify intent
    DeepThinking->>DeepThinking: Aristotle: Logic check
    DeepThinking->>DeepThinking: Musk: First principles
    DeepThinking->>DeepThinking: Feynman: Simplification
    DeepThinking->>DeepThinking: Munger: Risk analysis
    DeepThinking->>DeepThinking: Phase 5: SYNTHESIZE<br/>Decision
    end

    alt Review Status
        DeepThinking-->>FatherAgent: APPROVED
    else Rejected
        DeepThinking-->>FatherAgent: REJECTED<br/>Revision required
        FatherAgent->>DeepThinking: Resubmit design
    else Approved with Conditions
        DeepThinking-->>FatherAgent: APPROVED WITH CONDITIONS
        FatherAgent->>FatherAgent: Apply conditions
    end

    FatherAgent->>FatherAgent: Phase 4-7: CREATE
    FatherAgent-->>User: AGENT CREATED
    end

    rect rgb(220, 200, 255)
    Note over User,Agents: FLOW 2: Team Execution (Maestro Orchestration)

    User->>Maestro: /start problem
    Maestro->>Maestro: Load team config

    Maestro->>Agents: PHASE 1: UNDERSTAND
    Agents-->>Maestro: Problem Definition

    Maestro->>Agents: PHASE 2: DECONSTRUCT
    Agents-->>Maestro: First Principles

    Maestro->>Agents: PHASE 3: CHALLENGE
    Agents-->>Maestro: Risk Assessment

    par Parallel Phase 4
        Maestro->>Agents: Polya: Problem-Solving
        and
        Maestro->>Agents: Builders: Architecture
        and
        Maestro->>Agents: Executors: Strategy
    end
    Agents-->>Maestro: Solution Options

    Maestro->>Agents: PHASE 5: SYNTHESIZE
    Agents-->>Maestro: Final Solution

    Maestro-->>User: SOLUTION BLUEPRINT
    end

    rect rgb(255, 240, 200)
    Note over User,Output: FLOW 3: Diagram Generation (Parallel Workers)

    User->>Maestro: /diagram project_path
    Maestro->>Agents: EXPLORER analyzes
    Agents-->>Maestro: exploration-report.md

    par Parallel Diagram Generation
        Agents->>Agents: Architect: C4 Context
        and
        Agents->>Agents: Sequencer: Sequence
        and
        Agents->>Agents: Classifier: Class
        and
        Agents->>Agents: Modeler: ERD
        and
        Agents->>Agents: Mapper: Directory
        and
        Agents->>Agents: Logician: Logic
        and
        Agents->>Agents: Designer: UI/UX
    end

    Agents-->>Maestro: 7 Mermaid diagrams
    Maestro->>Agents: Phase 3: VERIFY
    Agents-->>Maestro: verification-report.md

    Maestro->>Output: Aggregate all
    Maestro-->>User: DIAGRAMS READY
    end
