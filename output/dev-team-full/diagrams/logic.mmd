%% Logic Flowchart - Execution Flow
%% Generated by Diagram Team - Session DTT-2026-01-04-DIAGRAM-002

flowchart TD
    Start([User Invokes: /microai:xxx]) --> Parse["System Detects:<br/>Agent Name vs Team Name"]

    Parse --> Decision{Type Check:<br/>Agent or Team?}

    Decision -->|Agent| AgentPath["Load agent.md<br/>from .microai/agents/"]
    Decision -->|Team| TeamPath["Load workflow.md<br/>from .microai/teams/"]

    AgentPath --> AgentLoad["Parse YAML Frontmatter"]
    AgentLoad --> AgentExec["Execute Agent Directly"]
    AgentExec --> AgentOutput["Agent Output"]
    AgentOutput --> AgentSave["Save Session"]
    AgentSave --> EndAgent([Agent Complete])

    TeamPath --> TeamLoad["Parse workflow.md"]
    TeamLoad --> SessionInit["Initialize Session"]
    SessionInit --> CheckConfig["Check Configuration"]

    CheckConfig --> ConfigDecision{Execution Mode?}

    ConfigDecision -->|Sequential| SeqMode["SEQUENTIAL MODE"]
    ConfigDecision -->|Parallel| ParaMode["PARALLEL MODE"]

    SeqMode --> Phase1["Phase 1: UNDERSTAND"]
    Phase1 --> Phase2["Phase 2: DECONSTRUCT"]
    Phase2 --> Phase3["Phase 3: CHALLENGE"]
    Phase3 --> Phase4["Phase 4: SOLVE"]
    Phase4 --> Phase5["Phase 5: SYNTHESIZE"]

    ParaMode --> ParaSetup["Setup Parallel Execution"]
    ParaSetup --> ParaLaunch["Launch Workers in Parallel"]
    ParaLaunch --> SyncPoint["SYNCHRONIZATION POINT"]
    SyncPoint --> ParaMerge["Merge Results"]
    ParaMerge --> Phase5

    Phase5 --> Verify{Verification:<br/>Quality gates?}

    Verify -->|Failed| VerifyFix["Fix issues"]
    VerifyFix --> Verify

    Verify -->|Passed| Aggregate["Aggregate Results"]

    Aggregate --> Save["AUTO-SAVE SESSION"]
    Save --> EndTeam([Team Complete])

    EndAgent --> FinalOutput["Return Results to User"]
    EndTeam --> FinalOutput
    FinalOutput --> End([Execution Complete])
