%% Sequence Diagram - Agent Creation and Execution Flow
%% Generated by Diagram Team - Session DTT-2026-01-04-DIAGRAM-001

sequenceDiagram
    autonumber
    participant User
    participant FatherAgent as Father Agent
    participant DesignDoc as Design Document
    participant DeepThinking as Deep Thinking Team
    participant Maestro as Maestro (Orchestrator)
    participant Thinkers as Thinkers (Socrates, Aristotle, Musk, Feynman)
    participant Builders as Builders (Linus, Dijkstra, Polya)
    participant Scribe as Scribe (Secretary)
    participant SpecializedTeam as Specialized Team/Agent
    participant ClaudeAPI as Claude API

    rect rgb(240, 248, 255)
        Note over User,FatherAgent: Phase 1: Discovery
        User->>FatherAgent: Request agent/team creation
        FatherAgent->>User: Ask domain, patterns, style
        User->>FatherAgent: Provide specifications
        FatherAgent->>FatherAgent: Validate input & check overlap
    end

    rect rgb(255, 248, 240)
        Note over FatherAgent,DesignDoc: Phase 2: Design Document Creation
        FatherAgent->>DesignDoc: Generate design document
        DesignDoc-->>FatherAgent: Design doc path
        FatherAgent->>User: Display design info
    end

    rect rgb(240, 255, 240)
        Note over FatherAgent,Scribe: Phase 3: Mandatory Design Review
        FatherAgent->>DeepThinking: Submit design for review
        DeepThinking->>Maestro: Orchestrate review session
        Maestro->>Scribe: Start recording (silent mode)

        par Phase 1: UNDERSTAND
            Maestro->>Thinkers: Socrates + Aristotle analyze problem
            Thinkers->>ClaudeAPI: Query for analysis
            ClaudeAPI-->>Thinkers: Response
            Thinkers-->>Maestro: Problem understanding
        end

        par Phase 2-3: DECONSTRUCT & CHALLENGE
            Maestro->>Thinkers: Musk + Feynman deconstruct
            Maestro->>Thinkers: Munger challenge risks
            Thinkers->>ClaudeAPI: Query for insights
            ClaudeAPI-->>Thinkers: Response
            Thinkers-->>Maestro: First principles & risks
        end

        par Phase 4: SOLVE
            Maestro->>Builders: Polya + contextual builders
            Builders->>ClaudeAPI: Query for solution
            ClaudeAPI-->>Builders: Response
            Builders-->>Maestro: Systematic solution
        end

        Maestro->>Scribe: Generate review output
        Scribe-->>Maestro: Review result (approved/rejected/conditions)
        Maestro-->>DeepThinking: Review complete
        DeepThinking-->>FatherAgent: Review status
    end

    rect rgb(255, 240, 245)
        Note over FatherAgent,User: Phase 4: Approval Gate
        alt Approved
            FatherAgent->>User: Design approved, proceeding...
        else Rejected
            FatherAgent->>User: Design rejected, revision required
            User->>FatherAgent: Revise and resubmit
            FatherAgent->>DeepThinking: Resubmit (loop back)
        else Approved with Conditions
            FatherAgent->>User: Approved with conditions
            FatherAgent->>FatherAgent: Apply conditions
        end
    end

    rect rgb(248, 240, 255)
        Note over FatherAgent,SpecializedTeam: Phase 5-6: Execution
        FatherAgent->>FatherAgent: Create directory structure
        FatherAgent->>FatherAgent: Generate agent/team files
        FatherAgent->>FatherAgent: Create knowledge files
        FatherAgent->>FatherAgent: Register command
        FatherAgent->>FatherAgent: Validate & archive design
    end

    rect rgb(240, 255, 248)
        Note over SpecializedTeam,ClaudeAPI: Phase 7: Team/Agent Execution
        User->>SpecializedTeam: Invoke via /microai:{name}
        SpecializedTeam->>ClaudeAPI: Execute workflow
        ClaudeAPI-->>SpecializedTeam: Responses
        SpecializedTeam-->>User: Deliver results
    end

    rect rgb(255, 255, 240)
        Note over FatherAgent,User: Completion
        FatherAgent->>User: Display success summary
        User->>SpecializedTeam: Test new agent/team
    end
