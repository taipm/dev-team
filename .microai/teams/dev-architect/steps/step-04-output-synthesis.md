# Step 04: Output Synthesis

## Objective
Generate output document based on session mode và dialogue content.

## Output Types by Mode

| Mode | Primary Output | Secondary Outputs |
|------|----------------|-------------------|
| design | Architecture Decision Record (ADR) | System diagram notes |
| review | Architecture Review Report | Action items |
| adr | ADR Document | None |

## Synthesis Flow

```
1. Summarize dialogue key points
2. Identify agreements và decisions
3. Generate appropriate output document
4. Present to both agents for sign-off
5. If changes needed → iterate
6. If approved → finalize
```

## Output Templates

### ADR Output (Design & ADR Modes)

```markdown
# ADR-{number}: {Title}

## Status
Proposed

## Date
{YYYY-MM-DD}

## Session Context
- **Session ID**: {session_id}
- **Participants**: Developer, Solution Architect
- **Discussion Turns**: {turn_count}

## Context
{Problem statement và background từ discussion}

## Decision Drivers
- {Driver 1 từ dialogue}
- {Driver 2 từ dialogue}
- {Driver 3 từ dialogue}

## Considered Options

### Option 1: {Name}
{Description từ Architect proposal}
- Good, because {từ discussion}
- Bad, because {từ Developer concerns}

### Option 2: {Name}
{Alternative discussed}
- Good, because {reasons}
- Bad, because {reasons}

## Decision Outcome
Chosen option: "{Selected option}" because {rationale từ consensus}.

### Positive Consequences
- {Từ agreement points}

### Negative Consequences
- {Acknowledged trade-offs}

## Implementation Notes (Developer)
- Complexity: {assessment}
- Timeline: {estimate}
- Dependencies: {list}
- Risks: {identified}

## Architecture Notes (Architect)
- Pattern applied: {pattern}
- Integration points: {list}
- Future considerations: {notes}

## Action Items
- [ ] {Action 1} - Owner: {Dev/Arch}
- [ ] {Action 2} - Owner: {Dev/Arch}

## Sign-off
| Role | Status |
|------|--------|
| Solution Architect | ✅ Approved |
| Developer | ✅ Approved |

---
Generated by Dev-Architect Team Simulation
Session ID: {session_id}
```

### Architecture Review Report (Review Mode)

```markdown
# Architecture Review Report

## Session Info
- **Session ID**: {session_id}
- **Date**: {date}
- **Topic**: {topic}
- **Reviewer**: Solution Architect

## Architecture Overview
{Summary của architecture được review}

## Review Findings

### Strengths
- {Strength 1 identified by Architect}
- {Strength 2}

### Concerns
| # | Concern | Severity | Recommendation |
|---|---------|----------|----------------|
| 1 | {Concern} | {High/Medium/Low} | {Recommendation} |
| 2 | {Concern} | {Severity} | {Recommendation} |

### Questions Resolved
- Q: {Question từ Architect}
  A: {Answer từ Developer}

## Checklist Results
- [x] Scalability considerations
- [x] Security review
- [ ] Performance testing plan
- [x] Error handling
- [ ] Monitoring strategy

## Recommendations
1. {Priority recommendation}
2. {Secondary recommendation}
3. {Nice-to-have}

## Action Items
| # | Action | Owner | Priority |
|---|--------|-------|----------|
| 1 | {Action} | {Owner} | {P1/P2/P3} |

## Verdict
{Approved / Approved with conditions / Needs revision}

## Sign-off
| Role | Status |
|------|--------|
| Solution Architect | {status} |
| Developer | {status} |

---
Generated by Dev-Architect Team Simulation
Session ID: {session_id}
```

## Sign-off Process

```
1. Display output document
2. AskUserQuestion: "Both agents approve?"
   Options:
   - "Approved" → Finalize
   - "Needs changes" → Specify changes
   - "Major revision" → Back to dialogue

3. If changes needed:
   - Architect makes changes OR
   - Developer makes changes OR
   - Both discuss specific section

4. Repeat until approved
```

## AskUserQuestion for Sign-off

```javascript
AskUserQuestion({
  questions: [{
    question: "Output document đã sẵn sàng. Cả hai agents approve?",
    header: "Sign-off",
    options: [
      { label: "Approved", description: "Finalize và save output" },
      { label: "Minor changes", description: "Chỉnh sửa nhỏ" },
      { label: "Major revision", description: "Quay lại discussion" }
    ],
    multiSelect: false
  }]
})
```

## Quality Checks Before Finalize

### ADR Quality
- [ ] Context clearly states the problem
- [ ] Options have pros/cons
- [ ] Decision rationale is clear
- [ ] Consequences are realistic
- [ ] Action items are actionable

### Review Report Quality
- [ ] Findings are specific
- [ ] Severity levels are appropriate
- [ ] Recommendations are actionable
- [ ] Verdict is clear

## Next Step

→ Proceed to **step-05-session-close.md**
