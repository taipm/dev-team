# Step 04: Output Synthesis

## Objective
Generate output document based on session mode và discussion content.

## Output Types by Mode

| Mode | Primary Output | Secondary Outputs |
|------|----------------|-------------------|
| requirements | User Stories Document | Acceptance criteria |
| tech-spec | Technical Specification | Implementation plan |
| estimation | Estimation Report | Risk assessment |

## Synthesis Flow

```
1. Summarize dialogue key points
2. Compile agreed items
3. Generate appropriate output document
4. Present to both agents for sign-off
5. If changes needed → iterate
6. If approved → finalize
```

## Output Templates

### User Stories Document (Requirements Mode)

```markdown
# User Stories: {Feature Name}

## Session Info
- **Session ID**: {session_id}
- **Date**: {date}
- **Feature**: {feature_name}
- **Participants**: PM, Developer

## Executive Summary
{2-3 sentences about the feature}

## User Stories

### US-{number}: {Title}

**As a** {user type},
**I want** {goal},
**So that** {benefit}.

#### Acceptance Criteria

**AC1: {Scenario}**
Given {precondition}
When {action}
Then {expected result}

**AC2: {Scenario}**
Given {precondition}
When {action}
Then {expected result}

#### Priority
{Must/Should/Could/Won't}

#### Notes
- {Note from discussion}
- {Edge case discussed}

---

[Repeat for each story]

## Out of Scope
- {Explicitly excluded 1}
- {Explicitly excluded 2}

## Open Questions
1. {Question needing follow-up}

## Dependencies
- {Dependency 1}
- {Dependency 2}

## Sign-off

| Role | Status |
|------|--------|
| Product Manager | ✅ |
| Developer | ✅ |

---
Generated by PM-Dev Team Simulation
Session ID: {session_id}
```

### Technical Specification (Tech Spec Mode)

```markdown
# Technical Specification: {Feature Name}

## Session Info
- **Session ID**: {session_id}
- **Date**: {date}
- **Feature**: {feature_name}

## 1. Overview

### Summary
{Feature description}

### Goals
- {Goal 1}
- {Goal 2}

### Non-Goals
- {Non-goal 1}

## 2. Requirements

### User Stories
- US-1: {story}
- US-2: {story}

### Non-Functional Requirements
- Performance: {requirements}
- Security: {requirements}

## 3. Technical Design

### Approach
{Technical approach from Dev}

### Components
| Component | Description |
|-----------|-------------|
| {component} | {description} |

### Data Model
{Schema changes if any}

### API Changes
{Endpoint changes if any}

## 4. Implementation Plan

### Milestones
1. {Milestone 1}: {duration}
2. {Milestone 2}: {duration}

### Dependencies
- {Dependency 1}

## 5. Estimates

| Component | Effort | Confidence |
|-----------|--------|------------|
| {comp} | {days} | {level} |
| **Total** | **{total}** | **{overall}** |

### Assumptions
- {Assumption 1}

## 6. Risks

| Risk | Likelihood | Impact | Mitigation |
|------|------------|--------|------------|
| {risk} | {L/M/H} | {L/M/H} | {mitigation} |

## 7. Open Questions
1. {Question}

## Sign-off

| Role | Status |
|------|--------|
| Product Manager | ✅ |
| Developer | ✅ |

---
Generated by PM-Dev Team Simulation
Session ID: {session_id}
```

### Estimation Report (Estimation Mode)

```markdown
# Estimation Report: {Feature Name}

## Session Info
- **Session ID**: {session_id}
- **Date**: {date}
- **Feature**: {feature_name}

## Scope Summary

### Stories Estimated
| # | Story | Priority |
|---|-------|----------|
| 1 | {story 1} | {priority} |
| 2 | {story 2} | {priority} |

### Total Stories: {count}

## Estimation Breakdown

### Detailed Estimates

#### {Story 1}
| Component | Optimistic | Expected | Pessimistic |
|-----------|------------|----------|-------------|
| {comp 1} | {days} | {days} | {days} |
| {comp 2} | {days} | {days} | {days} |
| **Subtotal** | **{days}** | **{days}** | **{days}** |

[Repeat for each story]

### Summary

| Story | Estimate | Confidence |
|-------|----------|------------|
| {story 1} | {days} | {H/M/L} |
| {story 2} | {days} | {H/M/L} |
| **Total** | **{total}** | **{overall}** |

## Assumptions
1. {Assumption 1}
2. {Assumption 2}

## Risks & Uncertainties

| Risk | Impact on Estimate | Mitigation |
|------|-------------------|------------|
| {risk} | +{days} | {mitigation} |

## Recommendations

### If Timeline is Fixed
- Cut: {what to remove}
- Keep: {must-haves}

### If Scope is Fixed
- Timeline: {recommended}
- Buffer: {percentage}

## Next Steps
1. {Action item 1}
2. {Action item 2}

## Sign-off

| Role | Status |
|------|--------|
| Product Manager | ✅ |
| Developer | ✅ |

---
Generated by PM-Dev Team Simulation
Session ID: {session_id}
```

## Sign-off Process

```
1. Display output document
2. AskUserQuestion: "Both agents approve?"
   Options:
   - "Approved" → Finalize
   - "Needs changes" → Specify changes
   - "Major revision" → Back to dialogue

3. If changes needed → iterate
4. Repeat until approved
```

## AskUserQuestion for Sign-off

```javascript
AskUserQuestion({
  questions: [{
    question: "Output document ready. Both agents approve?",
    header: "Sign-off",
    options: [
      { label: "Approved", description: "Finalize và save output" },
      { label: "Minor changes", description: "Chỉnh sửa nhỏ" },
      { label: "Major revision", description: "Quay lại discussion" }
    ],
    multiSelect: false
  }]
})
```

## Next Step

→ Proceed to **step-05-session-close.md**
